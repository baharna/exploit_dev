#!/usr/bin/python
#Fuzzes all commands from the RFC, does not fuzz the USER or PASS commands, those must be enabled

from boofuzz import *
from sys import exit

target_ip = "192.168.255.140"
target_port = 21

def main():
    
    t = Target(connection = SocketConnection(target_ip, target_port, proto='tcp'))
    session = Session(target=t, sleep_time=.5,crash_threshold_element = 20)
    
    s_initialize(name="Request")
    with s_block("user"):
        s_string("USER", fuzzable=False)
        s_delim(" ", fuzzable=False)
        s_string("test", fuzzable=False)
        s_static("\r\n")
    with s_block("pass"):
        s_string("PASS", fuzzable=False)
        s_delim(" ", fuzzable=False)
        s_string("test", fuzzable=False)
        s_static("\r\n")
    # s_group must be tied to the block in order for the values to iterate, otherwise it seems to just take the default value
    # in this instance we have tied the Commands group to the cmds blocks
    # if there is nothing marked as fuzzable in the defiend block, it does not seem to iterate through s_group
    with s_block("cmds","Commands"):
        s_group("Commands",values=["ABOR","ACCT", "ADAT", "ALLO", "APPE", "AUTH", "CCC", "CDUP", "CONF", "CWD", "DELE", "ENC", "EPRT", "EPSV", "FEAT", "HELP", "LANG", "LIST", "LPRT", "LPSV", "MDTM", "MIC", "MKD", "MLSD", "MLST", "MODE", "NLST", "NOOP", "OPTS", "PASV", "PBSZ", "PORT", "PROT", "PWD", "REIN", "REST", "RETR", "RMD", "RNFR", "RNTO", "SITE", "SIZE", "SMNT", "STAT", "STOR", "STOU", "STRU", "SYST", "TYPE", "XCUP", "XMKD", "XPWD", "XRCP", "XRMD", "XRSQ", "XSEM", "XSEN"])
        s_delim(" ", fuzzable=False)
        s_string("data")
        s_static("\r\n")

    session.connect(s_get("Request"))

    session.fuzz()


if __name__ == '__main__':
    main()
